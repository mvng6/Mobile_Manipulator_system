# 🚀 Mobile Manipulator 통합 제어 시스템 개발 프로세스

## 📋 프로젝트 개요

**목표**: 두산 로봇(ROS2)과 TR200 모바일 로봇(ROS1)을 하나의 노트북에서 통합 제어하여 협업 작업 수행

**최종 목표**: 가로 긴 물체의 갭 단차를 구간별로 연속 측정하는 자동화 시스템 구축

---

## 🎯 전체 개발 프로세스 로드맵

### Phase 1: 통신 인프라 구축 (1-2주)
**목표**: ROS2와 ROS1 간 브리지 통신 시스템 구축

### Phase 2: 통합 제어 시스템 개발 (2-3주)
**목표**: 두 로봇을 통합 제어하는 중앙 관리 시스템 구축

### Phase 3: 협업 작업 시퀀스 구현 (2-3주)
**목표**: 갭 단차 측정을 위한 협업 작업 로직 구현

### Phase 4: 시스템 통합 및 최적화 (1-2주)
**목표**: 전체 시스템 통합, 테스트, 성능 최적화

---

## 📊 현재 상태 및 진행률

### ✅ 완료된 작업 (100%)
- [x] 두산 로봇 ROS2 Humble 환경 구축
- [x] TR200 ROS1 Noetic Docker 환경 구축
- [x] 개별 로봇 제어 시스템 구현
- [x] 센서 기반 안전 제어 시스템
- [x] MoveIt 통합 및 경로 계획

### 🔄 진행 중인 작업 (0%)
- [ ] ROS2 ↔ ROS1 브리지 노드 개발
- [ ] 통합 제어 시스템 설계
- [ ] 협업 작업 시퀀스 정의

### 📋 향후 계획 (0%)
- [ ] 통합 런치 파일 개발
- [ ] 실시간 상태 모니터링 시스템
- [ ] 웹 기반 모니터링 인터페이스

**전체 진행률: 40% (인프라 구축 완료, 통신 및 통합 시스템 미구현)**

---

## 🚀 Phase 1: 통신 인프라 구축

### 1.1 ROS2 ↔ ROS1 브리지 노드 개발 ⭐ **최우선 작업**

#### 📋 작업 목표
ROS2 Humble 환경과 ROS1 Noetic 환경 간의 토픽 통신을 가능하게 하는 브리지 노드 구현

#### 🔧 기술적 요구사항
- **ROS2 측**: `ros1_bridge` 패키지 활용 또는 커스텀 브리지 구현
- **ROS1 측**: Docker 컨테이너 내 ROS1 노드와 통신
- **통신 방식**: TCP/UDP 소켓 또는 공유 메모리 활용

#### 📝 구현 계획
1. **브리지 노드 아키텍처 설계**
   - ROS2 → ROS1 방향 브리지
   - ROS1 → ROS2 방향 브리지
   - 양방향 통신 지원

2. **토픽 매핑 정의**
   ```
   ROS2 토픽 ↔ ROS1 토픽
   /doosan_status ↔ /doosan_status
   /doosan_measurement_data ↔ /doosan_measurement_data
   /tr200_status ↔ /tr200_status
   /tr200_position ↔ /tr200_position
   ```

3. **메시지 타입 변환**
   - ROS2 메시지 → ROS1 메시지 변환
   - 데이터 타입 호환성 보장

#### ⏱️ 예상 소요 시간: 3-5일

### 1.2 통신 테스트 및 검증

#### 📋 작업 목표
브리지 노드의 안정성과 성능 검증

#### 🔧 테스트 시나리오
1. **기본 통신 테스트**
   - 단방향 토픽 전송 테스트
   - 양방향 토픽 전송 테스트
   - 메시지 손실률 측정

2. **성능 테스트**
   - 지연 시간 측정
   - 처리량 측정
   - 동시 다중 토픽 처리 테스트

#### ⏱️ 예상 소요 시간: 2-3일

---

## 🎮 Phase 2: 통합 제어 시스템 개발

### 2.1 통합 제어 노드 설계

#### 📋 작업 목표
두 로봇의 상태를 모니터링하고 협업 작업을 조율하는 중앙 제어 시스템 구축

#### 🔧 핵심 기능
1. **상태 모니터링**
   - 두산 로봇 상태 실시간 모니터링
   - TR200 상태 실시간 모니터링
   - 협업 작업 진행률 추적

2. **작업 조율**
   - 측정 시작/완료 신호 처리
   - 이동 명령 전송
   - 안전 상태 확인

3. **에러 처리**
   - 로봇 오류 감지 및 대응
   - 안전 정지 메커니즘
   - 복구 절차 실행

#### 📝 구현 계획
1. **통합 제어 노드 클래스 설계**
   ```python
   class IntegratedControlNode(Node):
       def __init__(self):
           # ROS2 노드 초기화
           # 토픽 구독/발행 설정
           # 상태 관리 변수 초기화
   ```

2. **상태 머신 구현**
   - IDLE: 대기 상태
   - MEASURING: 측정 중
   - MOVING: 이동 중
   - ERROR: 오류 상태

3. **협업 로직 구현**
   - 측정 시퀀스 관리
   - 동기화 메커니즘
   - 진행률 추적

#### ⏱️ 예상 소요 시간: 5-7일

### 2.2 통합 런치 파일 개발

#### 📋 작업 목표
두 로봇 시스템을 동시에 실행할 수 있는 통합 런치 파일 구현

#### 🔧 구현 내용
1. **런치 파일 구조**
   ```python
   # integrated_control.launch.py
   def generate_launch_description():
       return LaunchDescription([
           # ROS2 환경 설정
           # 두산 로봇 노드들
           # TR200 Docker 컨테이너 실행
           # 브리지 노드 실행
           # 통합 제어 노드 실행
       ])
   ```

2. **파라미터 관리**
   - 측정 구간 설정
   - 이동 거리 설정
   - 안전 파라미터 설정

#### ⏱️ 예상 소요 시간: 2-3일

---

## 🤝 Phase 3: 협업 작업 시나리오 구현

### 3.1 갭 단차 측정 시퀀스 구현

#### 📋 작업 목표
가로 긴 물체의 갭 단차를 구간별로 연속 측정하는 협업 작업 로직 구현

#### 🔧 협업 시퀀스
1. **초기 설정**
   - TR200이 측정 시작 위치로 이동
   - 두산 로봇 초기 자세 설정
   - 측정 파라미터 로드

2. **측정 루프**
   ```
   TR200 위치 도착 → 두산 로봇 측정 시작 → 측정 완료 → 
   두산 로봇 초기 자세 복귀 → TR200 다음 구간 이동 → 반복
   ```

3. **완료 처리**
   - 전체 측정 데이터 통합
   - 결과 저장 및 리포트 생성
   - 로봇들 초기 위치 복귀

#### 📝 구현 계획
1. **협업 매니저 클래스**
   ```python
   class CollaborationManager:
       def __init__(self):
           self.current_section = 0
           self.total_sections = 0
           self.measurement_data = []
       
       def start_measurement_sequence(self):
           # 측정 시퀀스 시작
       
       def handle_measurement_complete(self):
           # 측정 완료 처리
       
       def move_to_next_section(self):
           # 다음 구간 이동
   ```

2. **상태 동기화**
   - 로봇 간 상태 동기화
   - 타이밍 제어
   - 오류 복구 로직

#### ⏱️ 예상 소요 시간: 7-10일

### 3.2 측정 데이터 관리 시스템

#### 📋 작업 목표
구간별 측정 데이터를 체계적으로 수집, 저장, 분석하는 시스템 구축

#### 🔧 구현 내용
1. **데이터 수집**
   - 실시간 측정 데이터 수집
   - 위치 정보 연동
   - 타임스탬프 관리

2. **데이터 저장**
   - CSV/JSON 형식으로 저장
   - 데이터베이스 연동 (선택사항)
   - 백업 및 복구 시스템

3. **데이터 분석**
   - 갭 단차 프로파일 생성
   - 품질 분석
   - 시각화 도구

#### ⏱️ 예상 소요 시간: 3-5일

---

## 🔧 Phase 4: 시스템 통합 및 최적화

### 4.1 전체 시스템 통합 테스트

#### 📋 작업 목표
모든 컴포넌트가 통합된 상태에서의 종합 테스트 수행

#### 🔧 테스트 시나리오
1. **기능 테스트**
   - 개별 로봇 제어 테스트
   - 브리지 통신 테스트
   - 통합 제어 테스트
   - 협업 작업 테스트

2. **성능 테스트**
   - 응답 시간 측정
   - 처리량 측정
   - 메모리 사용량 모니터링

3. **안정성 테스트**
   - 장시간 운영 테스트
   - 오류 상황 대응 테스트
   - 복구 능력 테스트

#### ⏱️ 예상 소요 시간: 5-7일

### 4.2 성능 최적화 및 튜닝

#### 📋 작업 목표
시스템 성능 최적화 및 안정성 향상

#### 🔧 최적화 영역
1. **통신 최적화**
   - 토픽 QoS 설정 최적화
   - 메시지 압축
   - 불필요한 통신 제거

2. **제어 최적화**
   - 제어 루프 주기 최적화
   - 경로 계획 최적화
   - 동기화 정확도 향상

3. **리소스 최적화**
   - CPU 사용률 최적화
   - 메모리 사용량 최적화
   - 네트워크 대역폭 최적화

#### ⏱️ 예상 소요 시간: 3-5일

---

## 🎯 첫 번째 단계: ROS2 ↔ ROS1 브리지 노드 개발

### 🚀 즉시 시작해야 할 작업

#### 1단계: 브리지 노드 패키지 생성
```bash
# 두산 워크스페이스에 브리지 패키지 생성
cd /home/ldj/mobile_manipulator_ws/doosan_ws/src
ros2 pkg create --build-type ament_python ros1_ros2_bridge
```

#### 2단계: 기본 브리지 노드 구현
- ROS2 노드로 구현
- ROS1과의 소켓 통신 구현
- 기본 토픽 매핑 구현

#### 3단계: 통신 테스트
- 단방향 통신 테스트
- 양방향 통신 테스트
- 메시지 손실률 검증

### 📋 첫 번째 작업 체크리스트

- [ ] 브리지 패키지 생성
- [ ] 기본 브리지 노드 클래스 구현
- [ ] ROS1-ROS2 토픽 매핑 정의
- [ ] 소켓 통신 구현
- [ ] 기본 통신 테스트
- [ ] 메시지 타입 변환 구현
- [ ] 에러 처리 로직 추가
- [ ] 성능 테스트 및 최적화

### ⏱️ 첫 번째 단계 예상 소요 시간: 3-5일

---

## 📊 진행 상황 모니터링

### 📈 주간 진행률 추적
- **Week 1**: 브리지 노드 기본 구현 (목표: 25%)
- **Week 2**: 브리지 노드 완성 및 테스트 (목표: 50%)
- **Week 3**: 통합 제어 시스템 개발 (목표: 75%)
- **Week 4**: 협업 시퀀스 구현 (목표: 90%)
- **Week 5**: 시스템 통합 및 최적화 (목표: 100%)

### 🎯 마일스톤 체크포인트
- [ ] **M1**: 브리지 노드 기본 통신 성공
- [ ] **M2**: 통합 제어 노드 구현 완료
- [ ] **M3**: 협업 작업 시퀀스 구현 완료
- [ ] **M4**: 전체 시스템 통합 테스트 성공
- [ ] **M5**: 성능 최적화 완료

### 📝 일일 작업 로그 템플릿
```
## YYYY-MM-DD 작업 로그

### 완료된 작업
- [ ] 작업 1
- [ ] 작업 2

### 진행 중인 작업
- [ ] 작업 3 (진행률: X%)

### 발생한 문제
- 문제 1: 설명
  - 해결 방법: 설명

### 내일 계획
- [ ] 작업 4
- [ ] 작업 5

### 전체 진행률: X%
```

---

## 🔧 개발 환경 및 도구

### 필수 도구
- **ROS2 Humble**: 두산 로봇 제어
- **ROS1 Noetic**: TR200 제어 (Docker)
- **Python 3.10+**: 브리지 노드 개발
- **Docker**: TR200 격리 환경
- **Git**: 버전 관리

### 권장 도구
- **VS Code**: 코드 편집
- **rqt**: ROS 디버깅
- **rosbag**: 데이터 기록/재생
- **PlotJuggler**: 데이터 시각화

### 디버깅 도구
- **ros2 topic echo**: 토픽 모니터링
- **ros2 node list**: 노드 상태 확인
- **ros2 service list**: 서비스 확인
- **htop**: 시스템 리소스 모니터링

---

## 📞 지원 및 문의

- **개발자**: ldj (KATECH 연구원)
- **프로젝트 시작**: 2025년 10월
- **문서 업데이트**: 2025년 10월 1일

### 참고 자료
- [두산 로봇 ROS2 패키지 문서](doosan_ws/src/doosan-robot2/README.md)
- [TR200 ROS 프로젝트 계획서](tr200_ros_docker_project/TR200_ROS_PROJECT_PLAN.md)
- [ROS1-ROS2 브리지 공식 문서](https://github.com/ros2/ros1_bridge)

---

**이 문서는 프로젝트 진행 과정을 체계적으로 관리하고 모니터링하기 위한 가이드입니다. 각 단계별로 명확한 목표와 체크리스트를 제공하여 효율적인 개발을 지원합니다.**
